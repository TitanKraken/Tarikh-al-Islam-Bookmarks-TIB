# The entry should be named in the same way that the elective succession law is named to define it's voter's logic.
# Root scope - Elector, the character voting in the election.
# scope:candidate scope - Candidate, Character considered for the title.
# scope:title scope - Title, The title the nomination is for.
# scope:holder scope - Ruler, The ruler currently holding the title.
# scope:holder_candidate scope - Favored Candidate, The title owner's candidate.
# The voter will vote for the top score candidate calculated from this script.

tib_islamic_dynastic_elective = { # Islamic Dynastic Monarchial Elective.
	electors = {
		add = holder # The Malik al-Muluk
		add = holder_close_or_extended_family
		add = {
			type = title_dejure_vassals
			limit = {
				scope:title = { # Either title is higher than Duke-tier, or must be primary.
					OR = {
						tier >= tier_kingdom
						holder = { has_primary_title = prev }
					}
				}
				OR = { # Either de facto direct vassal, or independent ruler who is de jure vassal. (no sub-vassals)
					liege = scope:holder
					is_independent_ruler = yes
				}
				trigger_if = { # Must be true priests
					limit = { has_government = theocracy_government }
					trigger_if = {
						limit = { is_female = yes }
						faith_dominant_gender_female_or_equal = yes
					}
					trigger_else = { faith_dominant_gender_male_or_equal = yes }
				}
			}
		}
		add = {
			type = holder_direct_vassals
		}
	}
	elector_vote_strength = { # More emphasis is put into restricting the successors within the dynastic house of the ruling family.
		base = 1
		modifier = { # Title Holder Bias
			desc = tooltip_dynastic_vote_strength_title_holder
			add = 2
			root = scope:holder
		}
		modifier = { # House Head for title holder Bias
			desc = tooltip_dynastic_vote_strength_house_head
			add = 1
			root = scope:holder.house_head
		}
		modifier = { # Dynasty Head for title holder Bias
			desc = tooltip_dynastic_vote_strength_house_head
			add = 1
			root = scope:holder.dynasty.dynast
		}
		modifier = { # Imperial Dignity
			desc = tooltip_feudal_vote_strength_emperor_tier
			add = 2
			highest_held_title_tier = 5 # empire_tier
		}
		modifier = { # Royal Dignity
			desc = tooltip_feudal_vote_strength_king_tier
			add = 1
			highest_held_title_tier = 4 # kingdom_tier
		}
		modifier = { # Powerful Vassal
			desc = tooltip_feudal_vote_strength_powerful_vassal
			add = {
				value = 1
				if = { # Additional point if the vassal is more powerful than the current ruler (Vassal King who meets this condition will have more voting power than the Emperor himself (1+1+1+2 = 5))
					limit = {
						max_military_strength > scope:holder.max_military_strength
					}
					add = 2
				}
			}
			NOT = { this = scope:holder }
			is_powerful_vassal = yes
			liege = scope:holder
		}
		modifier = { # Clerical Influence
			desc = tooltip_pious_vote_strength
			add = 2
			OR = {
				#government_has_flag = government_is_islamic_flag
				#government_has_flag = government_is_theocracy_flag
				has_council_position = councillor_court_chaplain
			}
			faith = scope:holder.faith
			faith = { has_doctrine = doctrine_theocracy_lay_clergy }
			NOT = { root = scope:holder.faith.religious_head }
		}
		modifier = { # Pious Influence
			desc = tooltip_pious_vote_strength
			add = 2
			root = {
				learning >= 10
				has_trait = zealous
			}
		}
		modifier = { # Qurayshi Influence
			desc = tooltip_feudal_vote_strength_pope
			add = 2
			OR = {
				has_trait = sayyid
				has_trait = sayyid_quraysh
				has_trait = fake_sayyid
			}
		}
		modifier = { # Caliph Influence
			desc = tooltip_feudal_vote_strength_pope
			add = 2
			root = scope:holder.faith.religious_head
		}
		modifier = { # Caliph Influence
			desc = tooltip_feudal_vote_strength_pope
			add = 2
			root = faith.religious_head
			faith = scope:holder.faith
		}
	}

	candidate_score = {
		base = 0
		# Islamic Dynastic Monarchial Elective uses very similar behavior to Feudal Elective. The few changes to the modifiers are already accounted for in the scripted_modifiers themselves.
		######################	Elector self-voting pattern	##########################
		elector_self_voting_pattern_feudal_elective_modifier = yes

		##########################	Holder voting pattern	##########################
		holder_voting_pattern_feudal_elective_modifier = yes

		##########################	Elector voting patterns (circumstances)	##########################
		elector_voting_pattern_circumstances_feudal_elective_modifier = yes

		##########################	Elector voting patterns (prestige/piety)	##########################
		elector_voting_pattern_prestige_piety_feudal_elective_modifier = yes

		##########################	Elector voting patterns (traits)	##########################
		elector_voting_pattern_traits_feudal_elective_modifier = yes

		##########################	Elector voting patterns (opinion)	##########################
		elector_voting_pattern_opinion_feudal_elective_modifier = yes
	}
	
	#scope:candidate = Candidate, scope:title = Title, scope:holder_candidate = Candidate currently selected by ruler.
	candidates = {
		add = {
			type = holder_close_or_extended_family
			#limit = {
			#	OR = {
			#		feudal_elective_potential_landless_dynastic_candidate_trigger = yes
			#		feudal_elective_potential_landless_claimant_candidate_trigger = yes
			#		feudal_elective_potential_landed_candidate_trigger = yes
			#	}
			#}
		}
		add = {
			type = holder_dynasty
			#limit = {
			#	OR = {
			#		feudal_elective_potential_landless_dynastic_candidate_trigger = yes
			#		feudal_elective_potential_landless_claimant_candidate_trigger = yes
			#		feudal_elective_potential_landed_candidate_trigger = yes
			#	}
			#}
		}
	}
}

tib_rashidun_elective = { # Rashidun Elective.
	elector_vote_strength = { # The pious (although preferebly rulers themselves) held more sway on who recieves the holy mandate as Ulul-Amri.
		base = 1
		modifier = { # Imperial Dignity
			desc = tooltip_feudal_vote_strength_emperor_tier
			add = 2
			highest_held_title_tier = 5 # empire_tier
		}
		modifier = { # Royal Dignity
			desc = tooltip_feudal_vote_strength_king_tier
			add = 1
			highest_held_title_tier = 4 # kingdom_tier
		}
		modifier = { # Pious Individuals / Ulama as replacements for Sahaba
			desc = tooltip_islamic_vote_strength_pious
			add = {
				value = 1
				if = { # Additional points if the individual has more virtuous traits and high piety level
					limit = {
						num_virtuous_traits = 1
					}
					add = 1
					limit = {
						num_virtuous_traits = 2
					}
					add = 2
					limit = {
						num_virtuous_traits = 3
					}
					add = 3
					limit = {
						piety_level = 3
					}
					add = 2
					limit = {
						piety_level = 4
					}
					add = 3
					limit = {
						piety_level = 5
					}
					add = 4
				}
			}
			NOT = { 
				this = scope:holder 
				is_powerful_vassal = yes
			}
				#liege = scope:holder
		}
		modifier = { # Clerical Influence
			desc = tooltip_feudal_vote_strength_theocrat
			add = 2
			NOT = { this = scope:holder }
			OR = {
				has_government = theocracy_government
				has_council_position = councillor_court_chaplain
			}
			faith = scope:holder.faith
			faith = { has_doctrine = doctrine_theocracy_lay_clergy }
			NOT = { root = scope:holder.faith.religious_head }
			#TODO_CD:Possible trigger checking for investiture succession?
		}
		modifier = { # Qurayshi Influence
			desc = tooltip_islamic_vote_strength_sayyid
			add = 3 # If a member of the Quraysh (or just Sayyid) his vote is quite important.
			#NOT = { this = scope:holder }
			OR = {
				has_trait = sayyid
				has_trait = sayyid_quraysh
			}
		}
		modifier = { # Caliph Influence
			desc = tooltip_islamic_vote_strength_caliph
			add = 2 # If the Caliph is an elector, his vote is quite important.
			#NOT = { this = scope:holder }
			root = scope:holder.faith.religious_head
			#TODO_CD:Possible trigger checking for investiture succession?
		}
		modifier = { # If the Holder votes his close family
			desc = tooltip_islamic_vote_strength_close_family
			add = 7 # Gives the electors strong reasons why not to side the choice of the Holder.
			NOT = { this = scope:holder }
			scope:potential_candidate = {
				is_close_family_of = scope:holder
			}
			#scope:holder_candidate = is_holder_close_or_extended_family
		}
	}
	
	electors = {
		max = 8  # Seven Distinguished House (Realm) Leaders + 1 Emperor.
		add = holder # The Malik al-Muluk
		add = {
			type = title_dejure_vassals # Anyone can vote from among the pious.
			limit = {
				scope:title = { # Either title is higher than Duke-tier, or must be primary.
					OR = {
						tier >= tier_kingdom
						holder = { has_primary_title = prev }
					}
				}
				OR = { # Either de facto direct vassal, or independent ruler who is de jure vassal. (no sub-vassals)
					liege = scope:holder
					is_independent_ruler = yes
					is_landed = no # Does not hold minimum baron or count
				}
				num_virtuous_traits >= 1
				trigger_if = { # Must be true priests
					limit = { has_government = theocracy_government }
					trigger_if = {
						limit = { is_female = yes }
						faith_dominant_gender_female_or_equal = yes
					}
					trigger_else = { faith_dominant_gender_male_or_equal = yes }
				}
			}
		}
		add = {
			type = holder_dynasty
			limit = {
				scope:title = { # Either title is higher than Duke-tier, or must be primary.
					OR = {
						tier >= tier_kingdom
						holder = { has_primary_title = prev }
					}
				}
				OR = { # Either de facto direct vassal, or independent ruler who is de jure vassal. (no sub-vassals)
					liege = scope:holder
					is_independent_ruler = yes
					is_landed = no # Does not hold minimum baron or count
				}
				num_virtuous_traits >= 1
				trigger_if = { # Must be true priests
					limit = { has_government = theocracy_government }
					trigger_if = {
						limit = { is_female = yes }
						faith_dominant_gender_female_or_equal = yes
					}
					trigger_else = { faith_dominant_gender_male_or_equal = yes }
				}
			}
		}
		add = {
			type = holder_direct_vassals # Anyone can vote from among the pious.
			limit = {
				scope:title = { # Either title is higher than Duke-tier, or must be primary.
					OR = {
						tier >= tier_kingdom
						holder = { has_primary_title = prev }
					}
				}
				OR = { # Either de facto direct vassal, or independent ruler who is de jure vassal. (no sub-vassals)
					liege = scope:holder
					is_independent_ruler = yes
					is_landed = no # Does not hold minimum baron or count
				}
				num_virtuous_traits >= 1
				trigger_if = { # Must be true priests
					limit = { has_government = theocracy_government }
					trigger_if = {
						limit = { is_female = yes }
						faith_dominant_gender_female_or_equal = yes
					}
					trigger_else = { faith_dominant_gender_male_or_equal = yes }
				}
			}
		}
		priority = {
			base = 1
			modifier = { # The Emperor is always picked.
				add = 200
				this = scope:holder
			}
			modifier = { # Pious Leaders. (specific titles, held by rulers of the same faith as the current holder)
				add = 10
				num_virtuous_traits = 2
			}
			modifier = { # Pious Leaders. (specific titles, held by rulers of the same faith as the current holder)
				add = 10
				num_virtuous_traits = 3
			}
			modifier = { # Pious Leaders. (specific titles, held by rulers of the same faith as the current holder)
				add = 15
				piety_level = 3
				piety_level = 4
				piety_level = 5
			}

			modifier = { # Fallback Electors
				add = {
					value = 10
					if = { # Favors same faith first.
						limit = {
							faith = scope:holder.faith
						}
						add = 30
					}
					if = { # Or compatible faith at least.
						limit = {
							faith = {
								faith_hostility_level = {
									target = scope:holder.faith
									value = faith_fully_accepted_level
								}
							}
						}
						add = 15
					}
					if = { # Slightly favor Muslim tribals, clans, theocracies or holy orders of same faith.
						limit = {
							OR = {
								has_government = tribal_government
								has_government = clan_government
								has_government = theocracy_government
							}
							faith = scope:holder.faith
						}
						add = 4
					}
					#if = { # Malus for other governments.
					#	limit = {
					#		has_government = republic_government
					#	}
					#	subtract = 5
					#}
					if = { #Malus for other governments.
						limit = {
							OR = {
								#has_government = tribal_government
								#has_government = clan_government
								has_government = mercenary_government
								has_government = holy_order_government
							}
						}
						subtract = 4
					}
					if = { # Slight prioritization for same culture.
						limit = {
							culture = scope:holder.culture
						}
						add = 4
					}
				}
			}
		}
	}

	candidate_score = {
		base = 0
		# Rashidun Elective uses very similar behavior to Feudal Elective. The few changes to the modifiers are already accounted for in the scripted_modifiers themselves.
		######################	Elector self-voting pattern	##########################
		elector_self_voting_pattern_feudal_elective_modifier = yes

		##########################	Holder voting pattern	##########################
		holder_voting_pattern_feudal_elective_modifier = yes

		##########################	Elector voting patterns (circumstances)	##########################
		elector_voting_pattern_circumstances_feudal_elective_modifier = yes

		##########################	Elector voting patterns (prestige/piety)	##########################
		elector_voting_pattern_prestige_piety_feudal_elective_modifier = yes

		##########################	Elector voting patterns (traits)	##########################
		elector_voting_pattern_traits_feudal_elective_modifier = yes

		##########################	Elector voting patterns (opinion)	##########################
		elector_voting_pattern_opinion_feudal_elective_modifier = yes
	}
	
	#scope:candidate = Candidate, scope:title = Title, scope:holder_candidate = Candidate currently selected by ruler.
	candidates = {
		# Quraysh
		add = {
			type = holder_dynasty
			limit = {
				faith = scope:holder.faith
				is_close_family_of = scope:holder
				feudal_elective_potential_landless_dynastic_candidate_trigger = yes
				#num_virtuous_traits >= 1
				#num_sinful_traits <= 1
				OR = {
					has_trait = sayyid
					has_trait = sayyid_quraysh
				}
			}
		}
		add = {
			type = title_dejure_vassals
			limit = {
				faith = scope:holder.faith
				is_close_family_of = scope:holder
				feudal_elective_potential_landless_dynastic_candidate_trigger = yes
				#num_virtuous_traits >= 1
				#num_sinful_traits <= 1
				OR = {
					has_trait = sayyid
					has_trait = sayyid_quraysh
				}
			}
		}
		add = {
			type = holder_direct_vassals
			limit = {
				faith = scope:holder.faith
				is_close_family_of = scope:holder
				feudal_elective_potential_landless_dynastic_candidate_trigger = yes
				#num_virtuous_traits >= 1
				#num_sinful_traits <= 1
				OR = {
					has_trait = sayyid
					has_trait = sayyid_quraysh
				}
			}
		}

		add = { # Pious individuals
			type = holder_dynasty
			limit = {
				faith = scope:holder.faith
				OR = {
					feudal_elective_potential_landless_dynastic_candidate_trigger = yes
					feudal_elective_potential_landless_claimant_candidate_trigger = yes
					feudal_elective_potential_landed_candidate_trigger = yes
				}
				AND = {
					num_virtuous_traits >= 1
					num_sinful_traits <= 1
				}
			}
		}
		add = { # Pious vassals only
			type = holder_direct_vassals
			limit = {
				faith = scope:holder.faith
				feudal_elective_potential_landed_candidate_trigger = yes
				AND = {
					num_virtuous_traits >= 1
					num_sinful_traits <= 1
				}
			}
		}
		add = {
			type = title_dejure_vassals
			limit = {
				faith = scope:holder.faith
				is_independent_ruler = yes # De jure vassals of the title who are not de facto vassals of the current ruler.
				feudal_elective_potential_landed_candidate_trigger = yes
				AND = {
					num_virtuous_traits >= 1
					num_sinful_traits <= 1
				}
			}
		}

		add = { # Pious title claimants
			type = title_claimants
			limit = {
				faith = scope:holder.faith
				feudal_elective_potential_landless_claimant_candidate_trigger = yes
				AND = {
					num_virtuous_traits >= 1
					num_sinful_traits <= 1
				}
			}
		}
		add = { # Close or extended family
			type = holder_close_or_extended_family
			limit = {
				faith = scope:holder.faith
				is_close_family_of = scope:holder
				feudal_elective_potential_landless_dynastic_candidate_trigger = yes
				AND = {
					num_virtuous_traits >= 1
					num_sinful_traits <= 1
				}
			}
		}
	}
}
