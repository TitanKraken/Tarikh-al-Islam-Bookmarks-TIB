# Fire AI invasion of Asia Minor in 1080
yearly_global_pulse = {
	on_actions = {
		trigger_invasion
	}
}

trigger_invasion = {
	effect = {
		if = {
			limit = {
				# date is 1080
				current_date >= 1069.12.31
				current_date < 1100.1.1
				# game started in 1066 or later
				game_start_date >= 1066.1.1
				# is ai
				title:e_persia.holder = {
					is_ai = yes
				}
				# won armenia war
				is_target_in_global_variable_list = {
					name = seljuk_invasion_progress
					target = flag:flag_won_armenia
				}
				# hasn't already declared war for Asia Minor
				NOT = {
					is_target_in_global_variable_list = {
						name = seljuk_invasion_progress
						target = flag:flag_invaded_asia_minor
					}
				}
			}
			title:e_persia.holder = {
				trigger_event = seljuk_invasion_events.1000
			}
		}
		# Almohad Invasion
		if = {
			limit = {
				current_date >= 1100.1.1
				current_date < 1120.1.1
				NOT = { has_global_variable = spawned_almohads }
			}
			debug_log = "Attempting to spawn Almohads within 240 days"
			trigger_event = {
				id = almohad_tib.0001
				days = { 2 240 }
			}
		}
		# TIB Mongol Invasion
		if = { 
			limit = { 
				has_game_rule = never_mongol_invasion
			}
		}
		else = {
			if = {
				limit = {
					game_start_date >= 1180.1.1
					current_date < 1300.1.1
					title:c_ulaanbaatar.holder = {
						is_ai = yes
					}
					NOT = { has_global_variable = mongols_have_appeared}
				}
				debug_log = "Attempting to spawn mongol invasion immediately"
				set_global_variable = {
					name = mongols_have_appeared
					value = yes
				}
				title:c_ulaanbaatar.holder = {
					trigger_event = mongol_invasion.0001
				}
			}
		}
	}
}