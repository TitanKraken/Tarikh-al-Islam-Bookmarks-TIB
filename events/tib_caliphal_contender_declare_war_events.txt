namespace = caliphal_contender_declare_war

# Scope saving!

caliphal_contender_declare_war.10 = { # Declare ROOT as a caliph contender!
	type = character_event
	title = caliphal_contender_declare_war.10.t
	desc = caliphal_contender_declare_war.10.desc
	theme = faith
	right_portrait = {
		character = cp:councillor_court_chaplain
		animation = throne_room_bow_1
	}
	left_portrait = {
		character = root
		animation = personality_zealous
	}

	option = {
		name = caliphal_contender_declare_war.10.a

		scope:root = {
			if = {
				limit = {
					scope:root = {
						NOR = {
							has_trait = sayyid
							has_trait = sayyid_quraysh
						}
					}
				}
				add_trait = fake_sayyid
			}
		}
		# Try to scope:founder rivals with scope:old_caliph.
        if = {
            limit = {
                can_set_relation_rival_trigger = { CHARACTER = scope:old_caliph }
            }
            set_relation_rival = {
                target = scope:old_caliph
                reason = rival_old_caliph_new_caliph
            }
        }
		if = {
            limit = {
                scope:old_caliph = {
                    is_independent_ruler = yes
                }
            }
            trigger_event = caliphal_contender_declare_war.1
        }
        else = {
            trigger_event = caliphal_contender_declare_war.12
        }
		faith = {
			every_faith_ruler = {
				limit = {
					highest_held_title_tier >= tier_county
					is_within_diplo_range = { CHARACTER = scope:old_caliph }
					is_within_diplo_range = { CHARACTER = scope:founder }
					NOT = { this = root }
				}
				trigger_event = caliphal_contender_declare_war.14
			}
		}

		ai_chance = {
			base = 70
		}
	}
}

caliphal_contender_declare_war.1 = { # If the HoF is independent
	type = character_event
	title = caliphal_contender_declare_war.1.t
	desc = caliphal_contender_declare_war.1.desc
	theme = war
	left_portrait = {
		character = root
		animation = personality_honorable
	}
	right_portrait = {
		character = scope:old_caliph
		animation = stress
	}
	#lower_center_portrait = {
	#	character = scope:old_caliph
	#	trigger = {
	#		valid_prior_caliph_available_trigger = { MS_TYPE = sunni }
	#	}
	#}

	option = {
		name = caliphal_contender_declare_war.1.a

		# Declares and launches war against the targeted Caliphate
		start_war = { # For independent Caliphate
			casus_belli = caliphal_revolution_war
			target = scope:old_caliph
			target_title = faith.religious_head_title
			target_title = faith.religious_head.primary_title
			#save_scope_as = caliphal_revolution_war
		}

		ai_chance = {
			base = 70
		}
	}
}
caliphal_contender_declare_war.12 = { # If the HoF is a vassal
	type = character_event
	title = caliphal_contender_declare_war.12.t
	desc = caliphal_contender_declare_war.12.desc
	theme = martial
	left_portrait = {
		character = root
		animation = personality_honorable
	}
	right_portrait = {
		character = scope:old_caliph
		animation = stress
	}
	lower_right_portrait = {
		character = scope:old_caliph.top_liege
	}

	option = {
		name = caliphal_contender_declare_war.12.a
		
		save_scope_as = old_caliph_titles
		# Declares and launches war against the targeted Caliphate
		start_war = { # For non-independent Caliphate
			casus_belli = caliphal_revolution_war
			target = scope:old_caliph.top_liege
			target = scope:old_caliph
			target_title = faith.religious_head_title
			target_title = faith.religious_head.primary_title
			#save_scope_as = caliphal_revolution_war
		}
		ai_chance = {
			base = 70
		}
	}
}

caliphal_contender_declare_war.13 = { # Victorious new HoF
	type = character_event
	title = caliphal_contender_declare_war.13.t
	desc = caliphal_contender_declare_war.13.desc
	theme = faith

	left_portrait = {
		character = root
		animation = war_defender
	}
	right_portrait = {
		character = scope:defender
		animation = fear
	}
	lower_right_portrait = {
		character = scope:defender.player_heir
	}

	option = {
		name = caliphal_contender_declare_war.13.a

		imprison = {
			target = scope:defender
		}
		imprison = {
			target = scope:defender.player_heir
		}
	}
}
caliphal_contender_declare_war.14 = { # Notification event for other rulers in diplo range
	type = character_event
	title = caliphal_contender_declare_war.14.t
	desc = caliphal_contender_declare_war.14.desc
	theme = crown

	right_portrait = {
		character = root
		animation = thinking
	}
	left_portrait = {
		character = scope:founder
		animation = personality_honorable
	}
	lower_right_portrait = {
		character = scope:defender.player_heir
	}
	#override_background = { event_background = throne_room }

	option = { # Support the Caliph!
		name = caliphal_contender_declare_war.14.a

		scope:root = {
			every_character_war = {
				limit = {
					primary_defender = scope:old_caliph
					primary_attacker = scope:founder
				}
				add_defender = scope:root
			}
		}
		ai_chance = {
			base = 30
			opinion_modifier = {
				opinion_target = scope:old_caliph
				multiplier = -0.5
			}
		}
	}
	option = { # Indeed it is a just revolution!
		name = caliphal_contender_declare_war.14.b

		scope:root = {
			every_character_war = {
				limit = {
					primary_defender = scope:old_caliph
					primary_attacker = scope:founder
				}
				add_attacker = scope:root
			}
		}
		ai_chance = {
			base = 30
			opinion_modifier = {
				opinion_target = scope:founder
				multiplier = -0.5
			}
		}
	}
}


# A temporal Sunni reformer decides their HoF.
caliphal_contender_declare_war.3 = {
	type = character_event
	title = caliphal_contender_declare_war.2.t
	desc = caliphal_contender_declare_war.2.desc
	theme = faith
	left_portrait = {
		character = root
		animation = worry
	}
	#lower_left_portrait = scope:sunni_caliph
	lower_center_portrait = {
		character = scope:old_caliph
	}

	#cooldown = { years = 10 }

	immediate = {
		play_music_cue = "mx_cue_sacredrite"
		# And sort defaults.
		set_default_caliph_effect = yes
	}

	# Let me think of suitable replacements...
	option = {
		name = caliphal_contender_declare_war.2.a
		trigger = { exists = scope:ROOT }

		#trigger_event = caliphal_candidates
		set_religious_head_title_to_and_gain_hook_effect = { NEW_RELIGIOUS_HEAD_TITLE = scope:old_caliph.player_heir }

		stress_impact = {
            humble = medium_stress_impact_loss
            arrogant = major_stress_impact_gain
        }

		ai_chance = {
			base = 70
		}
	}

	# Let me take up the mantle for myself!
	option = {
		name = caliphal_contender_declare_war.2.b
		trigger = { exists = scope:ROOT }

		# Set up the new HoF.
		set_religious_head_title_to_and_gain_hook_effect = { NEW_RELIGIOUS_HEAD_TITLE = scope:ROOT }
		# Had to make up your own Sayyid line if not Sayyid
		scope:ROOT = {
			if = {
				limit = {
					OR = {
						has_trait = sayyid
						has_trait = sayyid_quraysh
					}
				}
				add_trait = fake_sayyid
			}
		}

		stress_impact = {
            base = minor_stress_impact_gain
            humble = major_stress_impact_gain
            arrogant = medium_stress_impact_loss
			zealous = minor_stress_impact_loss
        }

		ai_chance = {
			base = 70
		}
	}
	
	# No option for striking out on your own immediately; you have a decision for that, or could've taken a different succession doctrine.
}

caliphal_candidates = {
	type = character_event
	title = caliphal_candidates.t
	desc = caliphal_candidates.desc
	theme = faith
	left_portrait = {
		character = root
		animation = worry
	}
	#lower_left_portrait = scope:sunni_caliph
	lower_center_portrait = {
		character = scope:old_caliph
		trigger = {
			valid_prior_caliph_available_trigger = { MS_TYPE = sunni }
		}
	}

	#cooldown = { years = 10 }

	# Let me think of suitable replacements...
	option = {
		name = caliphal_candidates.a
		trigger = { exists = scope:ROOT }

		# Set up the new HoF.
		get_ = {
			limit = {
				OR = {
					has_trait = sayyid
					has_trait = sayyid_quraysh
				}
			}
		}
		set_religious_head_title_to_and_gain_hook_effect = { NEW_RELIGIOUS_HEAD_TITLE = scope:ROOT }

		stress_impact = {
            humble = medium_stress_impact_loss
            arrogant = major_stress_impact_gain
        }

		ai_chance = {
			base = 70
		}
	}
	option = {
		name = caliphal_candidates.b
		trigger = { exists = scope:ROOT }

		stress_impact = {
            humble = medium_stress_impact_loss
            arrogant = major_stress_impact_gain
        }

		ai_chance = {
			base = 70
		}
	}
	option = {
		name = caliphal_candidates.c
		trigger = { exists = scope:ROOT }

		stress_impact = {
            humble = medium_stress_impact_loss
            arrogant = major_stress_impact_gain
        }

		ai_chance = {
			base = 70
			opinion_modifier = {
				opinion_target = scope:sunni_caliph
				multiplier = 5
			}
		}
	}
	option = {
		name = caliphal_candidates.d
		trigger = { exists = scope:ROOT }

		stress_impact = {
            humble = medium_stress_impact_loss
            arrogant = major_stress_impact_gain
        }

		ai_chance = {
			base = 70
		}
	}
	option = { # On second thought...
		name = caliphal_candidates.e
		trigger = { exists = scope:ROOT }

		trigger_event = caliphal_transfer_of_power

	}
}